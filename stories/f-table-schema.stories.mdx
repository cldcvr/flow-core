import { Meta, Story, Canvas, ArgsTable } from "@storybook/addon-docs";
import { html } from "lit-html";
import { unsafeSVG } from "lit-html/directives/unsafe-svg.js";
import getFakeUsers, { popoverRef } from "./utils/mock-users-data.ts";
import { createRef, ref } from "lit/directives/ref.js";
import downloadFile from "./donwloadFile.ts";

<Meta
	title="@cldcvr/flow-table/Components/f-table-schema"
	parameters={{
		controls: { hideNoControlsWarning: true }
	}}
/>

# f-table

<br />
<br />

## Overview

<f-divider></f-divider>

Schema based Table component includes rows and cells.

<br />

### [Playground](/story/components-f-table-schema--playground)

<Canvas>
	<Story
		name="Playground"
		argTypes={{
			variant: {
				control: "select",
				options: ["stripped", "outlined", "underlined", "bordered"]
			},
			size: {
				control: "select",
				options: ["medium", "small"]
			},
			selectable: {
				control: "select",
				options: ["single", "multiple", "none"]
			},
			["highlight-selected"]: {
				control: { type: "boolean" }
			},
			["highlight-hover"]: {
				control: { type: "boolean" }
			},
			["sticky-header"]: {
				control: { type: "boolean" }
			},
			["rows-per-page"]: {
				control: { type: "number" }
			},
			data: {
				control: { type: "object" }
			},
			["sort-by"]: {
				control: { type: "text" }
			},
			["sort-order"]: {
				control: "select",
				options: ["desc", "desc"]
			},
			["search-term"]: {
				control: { type: "text" }
			},
			["show-search-bar"]: {
				control: { type: "boolean" }
			}
		}}
		args={{
			variant: "stripped",
			size: "medium",
			selectable: "none",
			["highlight-selected"]: true,
			["highlight-hover"]: true,
			["sticky-header"]: true,
			["rows-per-page"]: 20,
			data: getFakeUsers(50),
			["sort-by"]: "firstName",
			["sort-order"]: "asc",
			["search-term"]: "",
			["show-search-bar"]: true
		}}
	>
		{args => {
			const handleNext = () => {
				console.log("in next event");
			};
			const toggleRowDetails = event => {
				console.log("on row toggled", event.detail);
			};
			const onRowInput = event => {
				console.log("on row input", event.detail);
			};
			const onHeaderSelect = event => {
				console.log("on header selected", event.detail);
			};
			const handleOverlayClick = () => {
				if (popoverRef.value) {
					popoverRef.value.open = false;
				}
			};
			return html`
				<f-popover ${ref(popoverRef)} @overlay-click=${handleOverlayClick}>
					<f-div padding="large" state="secondary">
						<f-text
							>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem
							Ipsum has been the industry's standard dummy text ever since the 1500s, when an
							unknown printer took a galley of type and scrambled it to make a type specimen
							book.</f-text
						>
					</f-div>
				</f-popover>
				<f-button style="display:none" label="download" @click=${downloadFile}></f-button>
				<f-div state="default" id="reportTemplate" overflow="scroll">
					<f-table-schema
						.data=${args.data}
						.highlightSelected=${args["highlight-selected"]}
						.highlightHover=${args["highlight-hover"]}
						.selectable=${args.selectable}
						.variant=${args.variant}
						.size=${args.size}
						.stickyHeader=${args["sticky-header"]}
						.rowsPerPage=${args["rows-per-page"]}
						.sortBy=${args["sort-by"]}
						.sortOrder=${args["sort-order"]}
						.searchTerm=${args["search-term"]}
						.showSearchBar=${args["show-search-bar"]}
						@next=${handleNext}
						@toggle-row-details=${toggleRowDetails}
						@row-input=${onRowInput}
						@header-selected=${onHeaderSelect}
					>
					</f-table-schema>
				</f-div>
			`;
		}}
	</Story>
</Canvas>

<br />

### data

<Canvas>
	<Story name="data">
		{args => {
			const data = getFakeUsers(5, 5);
			return html`
				<f-div gap="small" height="100%">
					<f-table-schema .data=${data}> </f-table-schema>
					<f-divider></f-divider>
					<f-div direction="column" gap="medium" padding="small">
						<f-text
							>Sample data used to display table.
							<a
								href="https://github.com/cldcvr/flow-core/blob/main/packages/flow-table/f-table-schema.doc.md"
								>Learn more</a
							></f-text
						>
						<f-divider></f-divider>
						<f-div>
							<pre>${JSON.stringify(data, undefined, 8)}</pre>
						</f-div>
					</f-div>
				</f-div>
			`;
		}}
	</Story>
</Canvas>

<br />

### sticky-header

<Canvas>
	<Story name="sticky-header">
		{args => {
			const data = getFakeUsers(30, 5);
			return html`
				<f-div gap="small" height="100%" overflow="scroll" gap="auto" width="100%">
					<f-div direction="column" gap="medium" overflow="hidden">
						<f-text> sticky-header=true</f-text>
						<f-table-schema .data=${data} .stickyHeader=${true}> </f-table-schema>
					</f-div>
					<f-divider></f-divider>
					<f-div direction="column" gap="medium" overflow="hidden">
						<f-text> sticky-header=false</f-text>
						<f-table-schema .data=${data} .stickyHeader=${false}> </f-table-schema>
					</f-div>
				</f-div>
			`;
		}}
	</Story>
</Canvas>

<br />

### rows-per-page

<Canvas>
	<Story name="rows-per-page">
		{args => {
			const data = getFakeUsers(30, 5);
			return html`
				<f-div gap="small" height="100%" overflow="scroll" gap="auto" width="100%">
					<f-div direction="column" gap="medium" overflow="hidden">
						<f-text> rows-per-page="5"</f-text>
						<f-table-schema rows-per-page="5" .data=${data} .stickyHeader=${true}> </f-table-schema>
					</f-div>
					<f-divider></f-divider>
					<f-div direction="column" gap="medium" overflow="hidden">
						<f-text> rows-per-page="10"</f-text>
						<f-table-schema rows-per-page="10" .data=${data} .stickyHeader=${false}>
						</f-table-schema>
					</f-div>
				</f-div>
			`;
		}}
	</Story>
</Canvas>

<br />

### sort-by

<Canvas>
	<Story name="sort-by">
		{args => {
			const data = getFakeUsers(10, 5);
			return html`
				<f-div gap="small" height="100%" overflow="scroll" gap="auto" width="100%">
					<f-div direction="column" gap="medium" overflow="hidden">
						<f-text> sort-by="firstName"</f-text>
						<f-table-schema sort-by="firstName" .data=${data} .stickyHeader=${true}>
						</f-table-schema>
					</f-div>
					<f-divider></f-divider>
					<f-div direction="column" gap="medium" overflow="hidden">
						<f-text> sort-by="age"</f-text>
						<f-table-schema sort-by="age" .data=${data} .stickyHeader=${false}> </f-table-schema>
					</f-div>
				</f-div>
			`;
		}}
	</Story>
</Canvas>

<br />

### sort-order

<Canvas>
	<Story name="sort-order">
		{args => {
			const data = getFakeUsers(10, 5);
			return html`
				<f-div gap="small" height="100%" overflow="scroll" gap="auto" width="100%">
					<f-div direction="column" gap="medium" overflow="hidden">
						<f-text> sort-by="firstName" sort-order="asc"</f-text>
						<f-table-schema
							sort-by="firstName"
							sort-order="asc"
							.data=${data}
							.stickyHeader=${true}
						>
						</f-table-schema>
					</f-div>
					<f-divider></f-divider>
					<f-div direction="column" gap="medium" overflow="hidden">
						<f-text> sort-by="firstName" sort-order="desc"</f-text>
						<f-table-schema
							sort-by="firstName"
							sort-order="desc"
							.data=${data}
							.stickyHeader=${false}
						>
						</f-table-schema>
					</f-div>
				</f-div>
			`;
		}}
	</Story>
</Canvas>

<br />

### search-term

<Canvas>
	<Story name="search-term">
		{args => {
			const data = getFakeUsers(50);
			return html`
				<f-div gap="small" height="100%" overflow="scroll" gap="auto" width="100%">
					<f-div direction="column" gap="medium" overflow="hidden">
						<f-text>search-term="female"</f-text>
						<f-table-schema search-term="female" .data=${data} .stickyHeader=${true}>
						</f-table-schema>
					</f-div>
				</f-div>
			`;
		}}
	</Story>
</Canvas>

<br />

### show-search-bar

<Canvas>
	<Story name="show-search-bar">
		{args => {
			const data = getFakeUsers(10, 5);
			return html`
				<f-div gap="small" height="100%" overflow="scroll" gap="auto" width="100%">
					<f-div direction="column" gap="medium" overflow="hidden">
						<f-text> show-search-bar="true"</f-text>
						<f-table-schema show-search-bar .data=${data}> </f-table-schema>
					</f-div>
					<f-divider></f-divider>
					<f-div direction="column" gap="medium" overflow="hidden">
						<f-text> show-search-bar="false"</f-text>
						<f-table-schema .showSearchBar=${false} .data=${data}> </f-table-schema>
					</f-div>
				</f-div>
			`;
		}}
	</Story>
</Canvas>

<br />

### @toggle-row-details

<Canvas>
	<Story name="@toggle-row-details">
		{args => {
			const data = getFakeUsers(10, 5);
			const fieldRef = createRef();
			const toggleRowDetails = event => {
				if (fieldRef.value) {
					fieldRef.value.textContent = JSON.stringify(event.detail, undefined, 2);
				}
			};
			return html`<f-div direction="column" state="subtle" padding="small" gap="large">
					<f-text>'toggle-row-details' event emitted whenever any row is open or closed</f-text>
					<f-table-schema .data=${data} @toggle-row-details=${toggleRowDetails}> </f-table-schema>
					<f-divider></f-divider>
				</f-div>
				<br />
				<f-divider></f-divider>
				<br />
				<f-text state="secondary">'event.detail' will display here</f-text>
				<pre ${ref(fieldRef)}></pre> `;
		}}
	</Story>
</Canvas>

<br />

### @row-input

<Canvas>
	<Story name="@row-input">
		{args => {
			const data = getFakeUsers(10, 5);
			const fieldRef = createRef();
			const handleEvent = event => {
				if (fieldRef.value) {
					fieldRef.value.textContent = JSON.stringify(event.detail, undefined, 2);
				}
			};
			return html`<f-div direction="column" state="subtle" padding="small" gap="large">
					<f-text
						>'row-input' event emitted whenever any row is selected through checkbox or
						radio</f-text
					>
					<f-table-schema .data=${data} selectable="multiple" @row-input=${handleEvent}>
					</f-table-schema>
					<f-divider></f-divider>
				</f-div>
				<br />
				<f-divider></f-divider>
				<br />
				<f-text state="secondary">'event.detail' will display here</f-text>
				<pre ${ref(fieldRef)}></pre> `;
		}}
	</Story>
</Canvas>

<br />

### @header-selected

<Canvas>
	<Story name="@header-selected">
		{args => {
			const data = getFakeUsers(10, 5);
			const fieldRef = createRef();
			const handleEvent = event => {
				if (fieldRef.value) {
					fieldRef.value.textContent = JSON.stringify(event.detail, undefined, 2);
				}
			};
			return html`<f-div direction="column" state="subtle" padding="small" gap="large">
					<f-text
						>'header-selected' event emitted whenever any column is selected by clicking on column
						header</f-text
					>
					<f-table-schema .data=${data} selectable="multiple" @header-selected=${handleEvent}>
					</f-table-schema>
					<f-divider></f-divider>
				</f-div>
				<br />
				<f-divider></f-divider>
				<br />
				<f-text state="secondary">'event.detail' will display here</f-text>
				<pre ${ref(fieldRef)}></pre> `;
		}}
	</Story>
</Canvas>

<br />

### @next

<Canvas>
	<Story name="@next">
		{args => {
			const data = getFakeUsers(50, 5);
			const fieldRef = createRef();
			const handleEvent = event => {
				if (fieldRef.value) {
					fieldRef.value.textContent = JSON.stringify(event.detail, undefined, 2);
				}
			};
			return html`<f-div direction="column" state="subtle" padding="small" gap="large" height="50%">
					<f-text
						>'next' event emitted whenever user reach to at the end of records by scrolling.</f-text
					>
					<f-table-schema .data=${data} rows-per-page="20" @next=${handleEvent}> </f-table-schema>
					<f-divider></f-divider>
				</f-div>
				<br />
				<f-divider></f-divider>
				<br />
				<f-text state="secondary">'event.detail' will display here</f-text>
				<pre ${ref(fieldRef)}></pre> `;
		}}
	</Story>
</Canvas>
